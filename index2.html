<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aerial Flap — Black Moon</title>

<style>
  :root{
    --accent: #a020f0;
    --glass-bg: rgba(255,255,255,0.06);
    --glass-border: rgba(255,255,255,0.12);
  }
  html,body{
    height:100%;
    margin:0;
    background:#000;
    color:#fff;
    font-family:Arial, sans-serif;
    overflow:hidden;
  }
  canvas{
    display:block;
    margin:0 auto;
    touch-action:none;
  }
  #score{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    top:14px;
    font-size:32px;
    z-index:60;
    text-shadow:0 0 12px var(--accent);
    font-weight:700;
  }
  #level{
    position:fixed;
    right:14px;
    top:14px;
    background:var(--glass-bg);
    border:1px solid var(--glass-border);
    padding:8px 12px;
    border-radius:12px;
    z-index:60;
  }

  /* Menú Glass */
  .menu{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:80;
    background:rgba(0,0,0,0.5);
    backdrop-filter:blur(6px);
  }
  .card{
    width:min(820px,94%);
    padding:28px;
    border-radius:16px;
    background:rgba(255,255,255,0.03);
    border:1px solid var(--glass-border);
    box-shadow:0 12px 40px rgba(0,0,0,0.6);
    display:flex;
    gap:22px;
    align-items:center;
  }
  .left{flex:1}
  .btn{
    padding:12px 18px;
    border-radius:12px;
    background:var(--glass-bg);
    border:1px solid var(--glass-border);
    cursor:pointer;
    color:#fff;
    font-weight:700;
  }
  .btn:hover{transform:translateY(-3px)}
  @media(max-width:640px){
    .card{flex-direction:column;align-items:stretch}
  }

  /* Overlay Game Over */
  .overlay{
    position:fixed; inset:0;
    display:none;
    align-items:center; justify-content:center;
    z-index:90;
    background:rgba(0,0,0,0.6);
  }
  .overlay.show{display:flex}
  .goCard{
    padding:22px;
    border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid var(--glass-border);
    text-align:center;
  }

</style>
</head>
<body>

<div id="score">0</div>
<div id="level">Nivel 1</div>

<!-- MENÚ -->
<div id="menu" class="menu">
  <div class="card">
    <div class="left">
      <h2 style="margin:0;font-size:28px">Aerial Flap</h2>
      <p>Versión Black Moon — Modo noche, luna animada, niveles, música, responsive.</p>
      <button class="btn" id="startBtn">Iniciar</button>
    </div>
  </div>
</div>

<!-- OVERLAY GAME OVER -->
<div id="overlay" class="overlay">
  <div class="goCard">
    <h3>Game Over</h3>
    <p id="goScore">Puntos: 0</p>
    <button class="btn" id="retryBtn">Reintentar</button>
  </div>
</div>

<!-- CANVAS -->
<canvas id="gameCanvas"></canvas>

<!-- AUDIO -->
<audio id="music1" src="music_level1.mp3" loop></audio>

<script>
/* ============== CANVAS RESPONSIVE ============== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let DPR = window.devicePixelRatio || 1;

function resize(){
  DPR = window.devicePixelRatio || 1;
  const w = window.innerWidth;
  const h = Math.floor(window.innerHeight * 0.92);
  canvas.style.width = w+"px";
  canvas.style.height = h+"px";
  canvas.width = w * DPR;
  canvas.height = h * DPR;
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
resize();
window.addEventListener("resize", resize);


/* ============== IMÁGENES (NO SE CAMBIARON RUTAS) ============== */
const birdImg = new Image();
birdImg.src = "bailarina.png";

const pillarImg = new Image();
pillarImg.src = "tela.png.png";

const moonImg = new Image();
moonImg.src = "luna.png";


/* ============== VARIABLES ============== */
let bird = { x:0, y:0, w:70, h:70, vy:0 };
let gravity = 0.25;     // ✔ Caída más lenta
let playing = false;
let score = 0;
let level = 1;

let pillars = [];
let spawnGap = 1400;
let spawnTimer = 0;

let speed = 2;
let speedScale = 1;

let last = 0;


/* ============== UI ELEMENTOS ============== */
const scoreEl = document.getElementById("score");
const levelEl = document.getElementById("level");
const startBtn = document.getElementById("startBtn");
const overlay = document.getElementById("overlay");
const goScore = document.getElementById("goScore");
const retryBtn = document.getElementById("retryBtn");
const music1 = document.getElementById("music1");


/* ============== CONTROLES ============== */
startBtn.onclick = startGame;
retryBtn.onclick = ()=>{ overlay.classList.remove("show"); startGame(); };
canvas.addEventListener("mousedown", flap);
canvas.addEventListener("touchstart", flap,{passive:false});
document.addEventListener("keydown",(e)=>{ if(e.code==="Space") flap(); });


/* ============== INICIO DEL JUEGO ============== */
function startGame(){
  score = 0;
  level = 1;
  speedScale = 1;
  pillars = [];
  spawnTimer = 0;
  playing = true;

  overlay.classList.remove("show");
  document.getElementById("menu").style.display="none";

  const w = canvas.width / DPR;
  const h = canvas.height / DPR;

  bird.x = w * 0.15;
  bird.y = h * 0.5;
  bird.w = w * 0.12;
  bird.h = bird.w;
  bird.vy = 0;

  music1.currentTime = 0;
  music1.play().catch(()=>{});

  last = performance.now();
  requestAnimationFrame(loop);
}


/* ============== FLOTAR / SALTO ============== */
function flap(){
  if(!playing) return;
  bird.vy = -8;
}


/* ============== GENERAR PILAR ============== */
function spawnPillar(){
  const h = canvas.height / DPR;

  let gap = h * 0.45;   // ✔ PILARES MÁS SEPARADOS
  let topH = Math.random() * (h * 0.40) + 40;

  pillars.push({
    x: (canvas.width / DPR) + 40,
    top: topH,
    bottom: topH + gap,
    w: 120
  });
}


/* ============== BUCLE PRINCIPAL ============== */
function loop(t){
  if(!playing) return;

  let dt = t - last;
  last = t;

  let w = canvas.width / DPR;
  let h = canvas.height / DPR;

  /* MOVIMIENTO */
  bird.vy += gravity * (dt/16);
  bird.y += bird.vy * (dt/16);

  let move = speed * speedScale * (dt/16);

  /* SPAWN DE PILARES */
  spawnTimer += dt;
  if(spawnTimer >= spawnGap){
    spawnTimer = 0;
    spawnPillar();
  }

  /* MOVER PILARES */
  for(let p of pillars){
    p.x -= move;
  }
  pillars = pillars.filter(p => p.x + p.w > -30);

  /* COLISIONES */
  for(let p of pillars){
    if(!p.passed && (p.x + p.w) < bird.x){
      p.passed = true;
      score++;
      updateHUD();
      updateLevel();
    }

    if(
      bird.x + bird.w > p.x &&
      bird.x < p.x + p.w &&
      (bird.y < p.top || bird.y + bird.h > p.bottom)
    ){
      gameOver();
      return;
    }
  }

  if(bird.y < 0 || bird.y + bird.h > h){
    gameOver();
    return;
  }

  draw(w,h);
  requestAnimationFrame(loop);
}


/* ============== HUD ============== */
function updateHUD(){
  scoreEl.textContent = score;
  levelEl.textContent = "Nivel "+level;
}

function updateLevel(){
  let newLevel = Math.floor(score/5)+1;
  if(newLevel !== level){
    level = newLevel;
    speedScale = 1 + (level-1)*0.10;
    spawnGap = Math.max(900, 1400 - (level-1)*40);
    updateHUD();
  }
}


/* ============== DRAW ============== */
function draw(w,h){
  ctx.clearRect(0,0,w,h);

  /* FONDO */
  let g = ctx.createLinearGradient(0,0,0,h);
  g.addColorStop(0,"#020014");
  g.addColorStop(1,"#000");
  ctx.fillStyle = g;
  ctx.fillRect(0,0,w,h);

  /* LUNA */
  const lx = (Math.sin(performance.now()*0.0002)*0.4+0.5) * w*0.8;
  const ly = 80;
  ctx.drawImage(moonImg, lx, ly, 120,120);

  /* PILARES */
  for(let p of pillars){
    ctx.drawImage(pillarImg, p.x, 0, p.w, p.top);
    ctx.drawImage(pillarImg, p.x, p.bottom, p.w, h - p.bottom);
  }

  /* BAILARINA */
  ctx.drawImage(birdImg, bird.x, bird.y, bird.w, bird.h);
}


/* ============== GAME OVER ============== */
function gameOver(){
  playing = false;
  music1.pause();

  goScore.textContent = "Puntos: "+score;
  overlay.classList.add("show");
}

</script>
</body>
</html>

