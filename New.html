<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Aerial Rhythm — Black Moon</title>

<style>
  body{
    margin:0;
    background:linear-gradient(180deg,#070a16,#0e0f1d,#1a0f28);
    font-family:Arial,Helvetica,sans-serif;
    color:#fff;
    overflow:hidden;
  }
  h1{
    text-align:center;
    padding:10px 0;
    font-size:24px;
    letter-spacing:2px;
    background:linear-gradient(90deg,#9333ff,#ff42c7);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin:8px 0 12px;
  }
  .game{
    width:100%;
    height:600px;
    position:relative;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  /* columnas de ritmo */
  .lane{
    width:90px;
    height:100%;
    border-left:1px solid rgba(255,255,255,0.06);
    border-right:1px solid rgba(255,255,255,0.06);
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .hit-zone{
    width:70px;
    height:18px;
    border-radius:6px;
    border:2px solid rgba(255,255,255,0.25);
    position:absolute;
    bottom:60px;
  }
  .note{
    width:70px;
    height:26px;
    border-radius:8px;
    position:absolute;
    background:linear-gradient(90deg,#9333ff,#ff42c7);
    box-shadow:0 0 12px rgba(255,0,200,0.6);
  }
  /* HUD */
  .hud{
    position:absolute;
    top:0;
    width:100%;
    display:flex;
    justify-content:space-between;
    padding:10px 20px;
    font-size:18px;
  }
  .multiplier{color:#b37dff;}
  /* silueta */
  .dancer{
    position:absolute;
    right:20px;
    bottom:60px;
    width:180px;
    height:260px;
    border-radius:20px;
    background:linear-gradient(180deg,#1a1a1a,#3a2350);
    box-shadow:inset 0 -50px 100px rgba(0,0,0,0.7);
    display:flex;
    align-items:flex-end;
    justify-content:center;
    font-weight:bold;
    font-size:14px;
  }
  .dancer.shake{
    animation:shake 0.25s linear;
  }
  @keyframes shake{
    0%{transform:translateX(0);}
    25%{transform:translateX(-10px);}
    50%{transform:translateX(10px);}
    75%{transform:translateX(-6px);}
    100%{transform:translateX(0);}
  }
  .controls{
    text-align:center;
    margin-top:6px;
  }
  button{
    padding:8px 14px;
    border:none;
    border-radius:6px;
    background:linear-gradient(90deg,#9333ff,#ff42c7);
    font-weight:bold;
    color:#fff;
    cursor:pointer;
  }
</style>
</head>

<body>

<h1>AERIAL RHYTHM — BLACK MOON</h1>

<div class="hud">
  <div>Puntaje: <span id="score">0</span></div>
  <div>Combo: <span id="combo">0</span></div>
  <div class="multiplier">x<span id="multi">1</span></div>
</div>

<div class="game">

  <div class="lane" id="lane1"><div class="hit-zone"></div></div>
  <div class="lane" id="lane2"><div class="hit-zone"></div></div>
  <div class="lane" id="lane3"><div class="hit-zone"></div></div>
  <div class="lane" id="lane4"><div class="hit-zone"></div></div>

  <div class="dancer" id="dancer">Ritmo</div>
</div>

<div class="controls">
  <button id="start">Iniciar</button>
  <p>Controles: <b>D – F – J – K</b></p>
</div>

<script>
/* ---------------- AERIAL RHYTHM ENGINE ---------------- */

const lanes = [
  document.getElementById("lane1"),
  document.getElementById("lane2"),
  document.getElementById("lane3"),
  document.getElementById("lane4")
];

let score = 0;
let combo = 0;
let multiplier = 1;
let notes = [];
let running = false;

const dancer = document.getElementById("dancer");
const scoreEl = document.getElementById("score");
const comboEl = document.getElementById("combo");
const multiEl = document.getElementById("multi");

/* ---- Simple beep sounds ---- */
function beep(freq=440, time=0.08){
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.connect(g);
  g.connect(ctx.destination);
  o.frequency.value = freq;
  g.gain.value = 0.15;
  o.start();
  g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + time);
  setTimeout(()=> o.stop(), time*1000 + 30);
}

/* ---- Spawn Notes ---- */
function spawnNote(){
  const laneIndex = Math.floor(Math.random()*4);
  const lane = lanes[laneIndex];
  const n = document.createElement("div");
  n.className="note";

  n.style.top = "-30px";
  lane.appendChild(n);

  notes.push({el:n, lane:laneIndex, y:-30});
}

/* ---- Game Loop ---- */
function loop(){
  if(!running) return;
  notes.forEach((n, i)=>{
    n.y += 4;
    n.el.style.top = n.y+"px";

    // Miss
    if(n.y > 600){
      miss();
      n.el.remove();
      notes.splice(i,1);
    }
  });

  requestAnimationFrame(loop);
}

/* ---- Hit detection ---- */
const hitKeys = {
  "d":0,
  "f":1,
  "j":2,
  "k":3
};

document.addEventListener("keydown", e=>{
  const key = e.key.toLowerCase();
  if(hitKeys[key] === undefined) return;

  hit(hitKeys[key]);
});

function hit(laneIndex){
  let best = null;
  let bestDist = 999;

  notes.forEach((n,i)=>{
    if(n.lane === laneIndex){
      const dist = Math.abs((n.y) - 520);
      if(dist < bestDist){
        bestDist = dist;
        best = {n,i};
      }
    }
  });

  if(best && bestDist < 45){
    perfectHit(best.n.el, best.i);
  }else{
    miss();
  }
}

/* ---- Perfect Hit ---- */
function perfectHit(el, index){
  score += 100 * multiplier;
  combo++;
  if(combo % 8 === 0) multiplier++;

  scoreEl.textContent = score;
  comboEl.textContent = combo;
  multiEl.textContent = multiplier;

  dancer.classList.add("shake");
  setTimeout(()=> dancer.classList.remove("shake"), 250);

  beep(700);
  el.remove();
  notes.splice(index,1);
}

/* ---- Miss ---- */
function miss(){
  combo = 0;
  multiplier = 1;
  comboEl.textContent = combo;
  multiEl.textContent = multiplier;
  beep(180);
}

/* ---- Start ---- */
document.getElementById("start").onclick = ()=> {
  if(running) return;
  running = true;

  setInterval(()=> spawnNote(), 600);
  loop();
};
</script>

</body>
</html>
