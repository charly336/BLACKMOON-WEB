<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>fly and flyp</title>
  <link reel="icon" href="grupo blawckmoon.ico">
  
  <style>
    :root{ --bg1:#11000a; --bg2:#89f7fe; --accent:#ff1493 }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background: url("aerial black moon.jpg"))}
    .center{display:flex;flex-direction:column;align-items:center;gap:8px;padding:18px}
    canvas{background: lightblue; no-repeat center;border-radius:10px;border:6px solid rgba(0,0,0,0.06);width:400px;height:600px}
    #ui{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:blue;border:black;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    #loading{font-size:14px;color:#222;background:#ffffffcc;padding:6px 10px;border-radius:8px}
    #debug{font-size:13px;color:#222;background:#fff8;padding:6px 10px;border-radius:8px}
    .small{font-size:12px;color:#1116}
  </style>
</head>
<body>
  <div class="center">
    <div id="loading">Cargando recursos... (esperando im√°genes)</div>
    <div id="ui">
      <button id="startBtn" disabled>Empezar</button>
      <button id="simBroken">Simular imagen rota</button>
       <button id="chooseBtn">Elegir im√°genes (opcional)</button>
    </div>

    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div class="small">Controles: Barra espaciadora o tecla ‚Üë para saltar / tocar la pantalla para m√≥viles.</div>
  </div>

  <!-- Recomendaci√≥n: reemplaza "gimnasta.png" y "tela.png" por tus archivos locales o URLs. -->
  <audio id="bgMusic" loop>
    <source src="15.-En el aire soy todo.m4a" type="audio/mpeg">
  </audio>

<script>
// --- Variables DOM ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const loadingEl = document.getElementById('loading');
const simBrokenBtn = document.getElementById('simBroken');
const chooseBtn = document.getElementById('chooseBtn');
const bgMusic = document.getElementById('bgMusic');

// --- Game state ---
let gimnasta = { x: 80, y: 150, width: 48, height: 48, gravity: 0.1, lift: -10, velocity: 0 };
let telas = [];
let frame = 0;
let score = 0;
let level = 1;
let gameSpeed = 2;
let running = false;
let spawnInterval = 90; // frames

// --- Gap configuration (cambia estos valores para separar m√°s o menos los pilares/telas) ---
const GAP_BASE = 220;       // tama√±o inicial del hueco entre telas (mayor = m√°s separaci√≥n)
const GAP_MIN = 150;        // gap m√≠nimo que no se reducir√°
const GAP_REDUCE_PER_LEVEL = 1; // cu√°nto se reduce el gap por nivel

// --- Assets ---
const gimnastaImg = new Image();
const telaImg = new Image();
let assets = { gimLoaded:false, telaLoaded:false, gimFailed:false, telaFailed:false };

// Paths por defecto (c√°mbialas si quieres):
let DEFAULT_GIM = 'ChatGPT Image 21 oct 2025, 12_41_43.png';
let DEFAULT_TELA = 'AF17A969-72F8-413B-93EB-896019AEDF68.png';

// Preload usando Promises
function preloadImages(gimPath = DEFAULT_GIM, telaPath = DEFAULT_TELA){
  gimnastaImg.src = '';
  telaImg.src = '';
  assets = { gimLoaded:false, telaLoaded:false, gimFailed:false, telaFailed:false };

  return new Promise(resolve => {
    let toFinish = 2;
    function done(){ toFinish--; if(toFinish === 0) resolve(); }

    gimnastaImg.onload = () => { assets.gimLoaded = true; done(); };
    gimnastaImg.onerror = () => { assets.gimFailed = true; assets.gimLoaded = true; done(); };

    telaImg.onload = () => { assets.telaLoaded = true; done(); };
    telaImg.onerror = () => { assets.telaFailed = true; assets.telaLoaded = true; done(); };

    // establecer src AL FINAL para que onload/onerror se disparen
    gimnastaImg.src = gimPath;
    telaImg.src = telaPath;
  });
}

function canDraw(img){
  // comprobar que la imagen est√° completamente cargada y no est√° rota
  return img && img.complete && img.naturalWidth > 0 && img.naturalHeight > 0;
}

// --- Fallbacks gr√°ficos (si las im√°genes fallan) ---
function drawFallbackGimnasta(x,y,w,h){
  const cx = x + w/2, cy = y + h/2;
  const r = Math.min(w,h)/2;
  const g = ctx.createRadialGradient(cx,cy, r*0.1, cx,cy, r);
  g.addColorStop(0,'#fff'); g.addColorStop(1,'#ff1493');
  ctx.fillStyle = g;
  ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fill();
  // cuerda
  ctx.strokeStyle = '#ff1493'; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(cx,cy-r); ctx.lineTo(cx,cy-r-28); ctx.stroke();
}

function drawFallbackTela(x,y,w,h){
  // tela con rayas diagonales
  ctx.fillStyle = '#ff8acb'; ctx.fillRect(x,y,w,h);
  ctx.save(); ctx.beginPath(); ctx.rect(x,y,w,h); ctx.clip();
  ctx.strokeStyle = 'rgba(255,255,255,0.25)'; ctx.lineWidth = 6;
  for(let i=-h;i<w;i+=24){ ctx.beginPath(); ctx.moveTo(x+i,y); ctx.lineTo(x+i+h,y+h); ctx.stroke(); }
  ctx.restore();
}

// --- Dibujado seguro que evita drawImage sobre im√°genes rotas ---
function drawGimnasta(){
  if(canDraw(gimnastaImg) && !assets.gimFailed){
    ctx.drawImage(gimnastaImg, gimnasta.x, gimnasta.y, gimnasta.width, gimnasta.height);
  } else {
    drawFallbackGimnasta(gimnasta.x, gimnasta.y, gimnasta.width, gimnasta.height);
  }
}

function drawTela(tela){
  if(canDraw(telaImg) && !assets.telaFailed){
    // cuando se usa una sola imagen para una tela, la estiramos para cubrir la pieza
    ctx.drawImage(telaImg, tela.x, tela.y, tela.width, tela.height);
  } else {
    drawFallbackTela(tela.x, tela.y, tela.width, tela.height);
  }
}

// --- L√≥gica del juego ---
function resetGame(){
  gimnasta.y = 100; gimnasta.velocity = -1; telas = []; frame = 0; score = 0; level = 1; gameSpeed = 1; spawnInterval = 90; running = false;
}

function startGame(){
  // Asegurarse que los assets han terminado (cargaron o fallaron)
  if(!(assets.gimLoaded && assets.telaLoaded)){
    loadingEl.textContent = 'Esperando a que terminen de cargarse las im√°genes...';
    return;
  }
  loadingEl.style.display = 'none';
  startBtn.disabled = true;
  running = true;
  // reproducir m√∫sica (al iniciar, interacci√≥n del usuario permite autoplay)
  bgMusic.play().catch(()=>{});
  requestAnimationFrame(loop);
}

function spawnTelas(){
  // Usamos la configuraci√≥n de gap definida arriba. Increase GAP_BASE para separar m√°s.
  const gap = Math.max(GAP_MIN, GAP_BASE - level * GAP_REDUCE_PER_LEVEL);
  const top = Math.floor(Math.random() * (canvas.height - gap - 120)) + 60; // evita bordes
  telas.push({ x: canvas.width, y: 0, width: 64, height: top });
  telas.push({ x: canvas.width, y: top + gap, width: 64, height: canvas.height - top - gap });
}

function loop(){
  if(!running) return;
  frame++;

  // f√≠sica gimnasta
  gimnasta.velocity += gimnasta.gravity;
  gimnasta.y += gimnasta.velocity;
  if(gimnasta.y + gimnasta.height > canvas.height){
    gimnasta.y = canvas.height - gimnasta.height; gimnasta.velocity = 0; endGame(); return;
  }
  if(gimnasta.y < 0) gimnasta.y = 0;

  // spawn
  if(frame % Math.max(40,spawnInterval - Math.floor(level*3)) === 0) spawnTelas();

  // mover y dibujar
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // fondo degradado (suave)
// Crear una imagen de fondo
const bgImage = new Image();
bgImage.src = ''; // üîπ Cambia esta ruta por la de tu imagen

bgImage.onload = function() {
  // Dibujar la imagen de fondo en todo el canvas
  ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);
  
  // Aqu√≠ puedes agregar el resto del dibujo del juego
};

  // telas
  for(let i = telas.length -1; i >= 0; i--){
    const t = telas[i];
    t.x -= gameSpeed;
    drawTela(t);

    // colisi√≥n AABB simple
    if(gimnasta.x < t.x + t.width && gimnasta.x + gimnasta.width > t.x && gimnasta.y < t.y + t.height && gimnasta.y + gimnasta.height > t.y){
      endGame(); return;
    }

    if(t.x + t.width < 0) telas.splice(i,1);
    // puntuaci√≥n cuando la pareja de telas pasa
    // cuando la tela inferior pasa el centro de la gimnasta
    if(!t.passed && t.y > 0 && t.x + t.width < gimnasta.x){ t.passed = true; score++; if(score%5===0){ level++; gameSpeed += 0.01; }}
  }

  // dibujar gimnasta
  drawGimnasta();

  // HUD
  ctx.fillStyle = '#111'; ctx.font = '16px sans-serif'; ctx.fillText('Puntos: ' + score, 10, 22);
  ctx.fillText('Nivel: ' + level, canvas.width - 90, 22);

  requestAnimationFrame(loop);
}

function endGame(){
  running = false; startBtn.disabled = false; startBtn.textContent = 'Reiniciar'; loadingEl.style.display = 'block'; loadingEl.textContent = 'Juego terminado. Presiona Reiniciar.';
  bgMusic.pause();
}

// --- Interacci√≥n: controles y selecci√≥n de im√°genes ---
document.addEventListener('keydown', e => { if(e.code === 'Space' || e.code === 'ArrowUp'){ gimnasta.velocity = gimnasta.lift; } });
canvas.addEventListener('touchstart', e=>{ gimnasta.velocity = gimnasta.lift; e.preventDefault(); }, {passive:false});

startBtn.addEventListener('click', ()=>{
  // si assets no terminaron, espera y luego inicia
  if(!(assets.gimLoaded && assets.telaLoaded)){
    loadingEl.textContent = 'Cargando im√°genes ‚Äî espere...';
    return;
  }
  // reiniciar estado y comenzar
  resetGame(); startGame();
});

simBrokenBtn.addEventListener('click', ()=>{
  // herramienta de pruebas: fuerza que las im√°genes fallen para ver el fallback
  assets.gimFailed = true; assets.telaFailed = true; loadingEl.textContent = 'Modo prueba: im√°genes simuladas como rotas (fallback activado).'; startBtn.disabled = false;
});

chooseBtn.addEventListener('click', ()=>{
  // permitir que el usuario cargue im√°genes locales usando input file
  const input = document.createElement('input'); input.type='file'; input.accept='image/*'; input.multiple=true;
  input.onchange = async (ev) => {
    const files = ev.target.files;
    if(files.length===0) return;
    // Si el usuario carga 1 imagen: ser√° la gimnasta; si 2: gimnasta + tela
    const urls = [];
    for(let i=0;i<Math.min(files.length,2);i++) urls.push(URL.createObjectURL(files[i]));
    loadingEl.textContent = 'Cargando im√°genes desde archivos...';
    await preloadImages(urls[0]||DEFAULT_GIM, urls[1]||DEFAULT_TELA);
    loadingEl.textContent = 'Im√°genes cargadas desde archivos.'; startBtn.disabled = false;
  };
  input.click();
});

// --- Iniciar preload autom√°tico al cargar la p√°gina ---
preloadImages().then(()=>{
  // mostrar estado (cargadas o fallback)
  if(assets.gimFailed || assets.telaFailed){
    loadingEl.textContent = 'Im√°genes no disponibles ‚Äî se usar√° fallback gr√°fico.';
  } else {
    loadingEl.textContent = 'Listo ‚Äî pulsa Iniciar para comenzar.';
  }
  startBtn.disabled = false;
});

// --- Nota: si quieres probar con im√°genes p√∫blicas, sustituye DEFAULT_GIM y DEFAULT_TELA por URLs v√°lidas ---
// Ejemplo (no activo):
// DEFAULT_GIM = 'https://example.com/mymi.png'; DEFAULT_TELA = 'https://example.com/tela.png';

</script>
</body>
</html>
