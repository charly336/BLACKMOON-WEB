<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Black Moon Test con Obst치culos</title>

<style>
body{
  margin:0;
  background:#111;
  color:white;
  font-family:Arial;
  overflow:hidden;
}

/* MENU */
#menu{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:10;
}

button{
  padding:15px 30px;
  font-size:18px;
}

/* HUD */
#hud{
  position:fixed;
  top:10px;
  left:10px;
}

/* CONTROLES */
#controls{
  position:fixed;
  bottom:20px;
  right:20px;
  display:flex;
  gap:10px;
}
.ctrl{
  width:70px;
  height:70px;
  border-radius:50%;
  font-size:20px;
}
</style>
</head>

<body>

<div id="menu">
  <button id="start">INICIAR</button>
</div>

<div id="hud">Salta los obst치culos</div>

<canvas id="game"></canvas>

<div id="controls">
  <button class="ctrl" id="left">拘勇</button>
  <button class="ctrl" id="jump">拘勇</button>
  <button class="ctrl" id="right">俱뫮잺</button>
</div>

<script>
/* ===== CANVAS ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* ===== JUGADOR ===== */
let player = {
  x:120,
  y:0,
  w:40,
  h:40,
  vy:0,
  gravity:0.8,
  jump:-15,
  onGround:false
};

/* ===== ESTADO ===== */
let running = false;
let moveL = false;
let moveR = false;
let speed = 5;

/* ===== OBST츼CULOS ===== */
let obstacles = [];
let spawnTimer = 0;

/* ===== CONTROLES ===== */
document.getElementById("left").onpointerdown = ()=>moveL=true;
document.getElementById("left").onpointerup = ()=>moveL=false;
document.getElementById("right").onpointerdown = ()=>moveR=true;
document.getElementById("right").onpointerup = ()=>moveR=false;

document.getElementById("jump").onclick = jump;

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") moveL=true;
  if(e.key==="ArrowRight") moveR=true;
  if(e.key===" "||e.key==="ArrowUp") jump();
});
document.addEventListener("keyup",e=>{
  if(e.key==="ArrowLeft") moveL=false;
  if(e.key==="ArrowRight") moveR=false;
});

function jump(){
  if(player.onGround){
    player.vy = player.jump;
    player.onGround = false;
  }
}

/* ===== LOOP ===== */
function loop(){
  if(!running) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* Fondo */
  ctx.fillStyle="#222";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  /* Suelo */
  ctx.fillStyle="#000";
  ctx.fillRect(0,canvas.height-50,canvas.width,50);

  /* Jugador */
  if(moveL) player.x -= 4;
  if(moveR) player.x += 4;

  player.vy += player.gravity;
  player.y += player.vy;

  if(player.y + player.h >= canvas.height-50){
    player.y = canvas.height-50-player.h;
    player.vy = 0;
    player.onGround = true;
  }

  ctx.fillStyle="#b400ff";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  /* Obst치culos */
  spawnTimer++;
  if(spawnTimer > 90){
    obstacles.push({
      x:canvas.width,
      y:canvas.height-80,
      w:30,
      h:30
    });
    spawnTimer = 0;
  }

  obstacles.forEach((o,index)=>{
    o.x -= speed;
    ctx.fillStyle="#ff0055";
    ctx.fillRect(o.x,o.y,o.w,o.h);

    /* Colisi칩n */
    if(
      player.x < o.x + o.w &&
      player.x + player.w > o.x &&
      player.y < o.y + o.h &&
      player.y + player.h > o.y
    ){
      alert("游눤 Choque");
      location.reload();
    }

    if(o.x + o.w < 0){
      obstacles.splice(index,1);
    }
  });

  requestAnimationFrame(loop);
}

/* ===== START ===== */
document.getElementById("start").onclick = ()=>{
  document.getElementById("menu").style.display="none";
  player.y = canvas.height-90;
  running = true;
  loop();
};
</script>

</body>
</html>
