<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rompecabezas - BlackMoon Games</title>
  <style>
    :root{ --frame-padding:18px; --gap:6px; }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial;background:#111;color:#eee}
    /* Pantalla de inicio */
    #splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:#000;z-index:50}
    #splash img{max-width:60vw;max-height:40vh;object-fit:contain;border-radius:8px}
    #splash h1{margin:18px 0 0;font-size:20px;letter-spacing:2px}

    /* Contenedor del juego */
    .app{display:flex;flex-direction:column;min-height:100vh}
    header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px}
    .left-controls{display:flex;gap:8px;align-items:center}
    .level-indicator{font-weight:700}

    main{flex:1;display:flex;gap:16px;padding:20px;box-sizing:border-box}
    /* Zona juego + marco madera */
    .game-wrap{flex:1;display:flex;align-items:center;justify-content:center}
    .frame{
      background:var(--frame-bg,linear-gradient(180deg,#6b4a2f,#4a2b18)); /* fallback madera */
      padding:var(--frame-padding);
      border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.6);
    }
    /* tablero responsivo: ocupa máximo de la pantalla sin pisar los controles */
    #board{display:grid;gap:var(--gap);background:#000;padding:6px;border-radius:6px;box-sizing:border-box}
    .tile{background-size:cover;background-position:center;border-radius:4px;cursor:pointer;user-select:none}
    .tile.empty{background:transparent;cursor:default}

    /* Panel lateral para enlaces e imagenes editables (solo desarrollador) */
    .side{width:320px;max-width:40vw;display:flex;flex-direction:column;gap:10px}
    .card{background:rgba(255,255,255,0.03);padding:12px;border-radius:8px}
    .links img{width:100%;height:90px;object-fit:cover;border-radius:6px}

    footer{padding:12px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,rgba(0,0,0,0.3),transparent)}
    footer img{height:36px}

    /* Controls */
    .controls button{padding:8px 10px;border-radius:6px;border:0;background:#222;color:#fff;cursor:pointer}
    .controls input[type=range]{width:120px}

    /* Responsive adjustments */
    @media (max-width:900px){main{flex-direction:column}.side{width:100%;max-width:100%}}
  </style>
</head>
<body>
  <!-- ====== PANTALLA DE INICIO (negra) ====== -->
  <div id="splash">
    <img id="splash-img" src="assets/splash.jpg" alt="Splash (reemplazar por desarrollador)"/>
    <h1>blackmoon games</h1>
    <div style="height:18px"></div>
    <button id="startBtn" style="padding:10px 16px;border-radius:8px;border:0;background:#fff;color:#000;cursor:pointer">Iniciar</button>
  </div>

  <div class="app" id="app" style="display:none">
    <header>
      <div class="left-controls">
        <div class="level-indicator">Nivel <span id="levelNum">1</span>/20</div>
        <div class="controls" style="display:flex;gap:8px;align-items:center;margin-left:10px">
          <button id="prevLevel">◀</button>
          <button id="nextLevel">▶</button>
          <button id="shuffleBtn">Barajar</button>
          <button id="restartBtn">Reiniciar</button>
        </div>
      </div>
      <div class="music-controls">
        <button id="musicToggle">ON</button>
        <button id="volDown">-</button>
        <input id="volRange" type="range" min="0" max="1" step="0.01" value="0.7">
        <button id="volUp">+</button>
      </div>
    </header>

    <main>
      <div class="game-wrap">
        <div class="frame" id="frame">
          <div id="board"></div>
        </div>
      </div>

      <aside class="side">
        <div class="card">
          <strong>Enlaces (área vacía)</strong>
          <div class="links" style="display:flex;gap:8px;margin-top:8px">
            <a id="link1" href="https://open.spotify.com/intl-es/artist/4lF7Q4iXqYQgTGV2rtNteG?si=z_CpBKFxTvmgi8BocjqH-w" target="_blank"><img id="link1img" src="Imagen de WhatsApp 2025-10-03 a las 13.27.12_d93fc255.jpg" alt="Link 1 (editar por dev)"></a>
            <a id="link2" href="https://open.spotify.com/show/1Jw4Vem2XkNuCG9pKqHRXy?si=45ecb656ef0c4550" target="_blank"><img id="link2img" src="BKM PODCAST 2.0.jpg" alt="Link 2 (editar por dev)"></a>
          </div>
        </div>

        <div class="card">
          <strong>Fondo fuera del juego</strong>
          <p style="font-size:13px;margin:8px 0">(reemplazar imagen en assets or modificar variable <code>OUTER_BG</code>)</p>
          <div style="height:8px"></div>
          <strong>Frame (madera)</strong>
          <p style="font-size:13px;margin:8px 0">(reemplazar <code>FRAME_IMAGE</code> en sección de desarrollador)</p>
        </div>

        <div class="card">
          <strong>Información</strong>
          <p style="font-size:13px;margin:8px 0">Haz clic en las piezas para intercambiar. Para niveles más altos habrá más piezas.</p>
        </div>
      </aside>
    </main>

    <footer>
      <div>grupo blackmoon</div>
      <img id="footerImg" src="GPO BKM 2.jpg" alt="Footer">
    </footer>

    <!-- Audio (20 niveles -> 5 canciones, cada 4 niveles una canción) -->
    <audio id="bgAudio" loop></audio>
  </div>

  <script>
    /* =========================
       *  SECCIÓN PARA DESARROLLADOR (editar SOLO aquí)
       *  Cambia rutas de imágenes y audios aquí. El juego asume que SOLO el desarrollador
       *  modificará estas variables. No modifiques lógica debajo si no eres desarrollador.
       * ========================= */

    const ASSETS = {
      // Imagen que se usará como puzzle (puedes preparar 20 imágenes o usar la misma),
      // formato: ["path/to/img1.jpg", ...] length >= 1. El juego selecciona por nivel índice.
      PUZZLE_IMAGES: [
        'GPO BKM 2.jpg',
        'aerial black moon.jpg',
        'Imagen de WhatsApp 2025-10-03 a las 13.27.12_d93fc255.jpg',
        'PRODUCTOS BLACKMOON.png',
        'OIP (2).jpeg',
        'aerial black moon.jpg',
        'systems2.jpg',
        'aerial moon dance.jpg',
        'PRODUCTOS BLACKMOON.png',
        'GPO BKM 2.jpg',
        'Imagen de WhatsApp 2025-11-02 a las 17.12.14_83e6c797.jpg',
        'blackmoon podcast.png',
        'img_productos.jpg',
        'aerial moon dance.jpg',
        'GPO BKM 2.jpg',
        'Imagen de WhatsApp 2025-11-02 a las 17.12.14_83e6c797.jpg',
        'BKM PODCAST 2.0.jpg',
        'bkmprdcts.jpeg',
        'PRODUCTOS BLACKMOON.png',
        'GPO BKM 2.jpg'
      ],

      // Imagen de pantalla inicial (negra con imagen centrada)
      SPLASH_IMAGE: 'assets/splash.jpg',

      // Imagen para el marco madera (border-image) - si dejas vacío, usa fondo CSS
      FRAME_IMAGE: '', // e.g. 'assets/frame-wood.png'

      // Footer logo
      FOOTER_LOGO: 'GPO BKM 2.j',

      // Link images
      LINK1: 'BKM PODCAST 2.0.jpg',
      LINK2: 'BLACKMOON RECORDS.jpg',

      // Fondo fuera de la zona de juego
      OUTER_BG: 'GPO BKM 2.jpg',

      // Audios (5 canciones, una por cada bloque de 4 niveles)
      AUDIO_TRACKS: [
        '9.-Soy un fénix en el aire.m4a',
        '15.-En el aire soy todo.m4a',
        '6.-Silencio de la Noche.m4a',
        '1.- Volando con Black Moon.m4a',
        '8.-Soy un Quetzal en el Viento.m4a'
      ]
    };

    /* =========================
       *  LÓGICA DEL JUEGO (no hace falta tocar)
       * ========================= */

    // Nivel -> grid size mapping
    const LEVEL_MAP = (lvl)=>{
      if(lvl<=4) return 2;
      if(lvl<=8) return 3;
      if(lvl<=12) return 4;
      if(lvl<=16) return 5;
      return 6; // 17-20
    };

    // Estado
    let level = 1;
    let gridSize = LEVEL_MAP(level);
    let tiles = []; // array of tile indices
    let emptyIndex = null;
    let selectedTile = null;

    // DOM
    const splash = document.getElementById('splash');
    const startBtn = document.getElementById('startBtn');
    const app = document.getElementById('app');
    const levelNum = document.getElementById('levelNum');
    const board = document.getElementById('board');
    const bgAudio = document.getElementById('bgAudio');
    const musicToggle = document.getElementById('musicToggle');
    const volRange = document.getElementById('volRange');
    const volUp = document.getElementById('volUp');
    const volDown = document.getElementById('volDown');
    const prevLevel = document.getElementById('prevLevel');
    const nextLevel = document.getElementById('nextLevel');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const restartBtn = document.getElementById('restartBtn');

    // links and images
    document.getElementById('splash-img').src = ASSETS.SPLASH_IMAGE;
    document.getElementById('footerImg').src = ASSETS.FOOTER_LOGO;
    document.getElementById('link1img').src = ASSETS.LINK1;
    document.getElementById('link2img').src = ASSETS.LINK2;
    document.getElementById('link1').href = '#';
    document.getElementById('link2').href = '#';

    // Outer background
    document.body.style.background = ASSETS.OUTER_BG ? `url(${ASSETS.OUTER_BG}) center/cover fixed` : '#111';

    // Frame image
    if(ASSETS.FRAME_IMAGE){
      document.getElementById('frame').style.background = `url(${ASSETS.FRAME_IMAGE}) center/cover`;
      document.documentElement.style.setProperty('--frame-padding','24px');
    }

    // music initial
    bgAudio.volume = parseFloat(volRange.value);
    function setMusicForLevel(lvl){
      const idx = Math.min(Math.floor((lvl-1)/4), ASSETS.AUDIO_TRACKS.length-1);
      bgAudio.src = ASSETS.AUDIO_TRACKS[idx] || '';
      if(musicToggle.dataset.state==='on') bgAudio.play().catch(()=>{});
    }

    musicToggle.dataset.state = 'on';
    musicToggle.addEventListener('click',()=>{
      if(musicToggle.dataset.state==='on'){
        musicToggle.dataset.state='off'; musicToggle.textContent='OFF'; bgAudio.pause();
      }else{musicToggle.dataset.state='on'; musicToggle.textContent='ON'; bgAudio.play().catch(()=>{});}    
    });
    volRange.addEventListener('input',()=>{bgAudio.volume = parseFloat(volRange.value);});
    volUp.addEventListener('click',()=>{volRange.value = Math.min(1, +volRange.value+0.1); volRange.dispatchEvent(new Event('input'));});
    volDown.addEventListener('click',()=>{volRange.value = Math.max(0, +volRange.value-0.1); volRange.dispatchEvent(new Event('input'));});

    // level nav
    prevLevel.addEventListener('click', ()=>{ level=Math.max(1,level-1); loadLevel(); });
    nextLevel.addEventListener('click', ()=>{ level=Math.min(20,level+1); loadLevel(); });
    shuffleBtn.addEventListener('click',()=>{ shuffleTiles(); renderBoard(); });
    restartBtn.addEventListener('click',()=>{ startLevel(); });

    startBtn.addEventListener('click', ()=>{ splash.style.display='none'; app.style.display='block'; setMusicForLevel(level); if(musicToggle.dataset.state==='on') bgAudio.play().catch(()=>{}); loadLevel(); });

    // Build board responsively
    function calculateBoardSize(){
      // leave some padding for side panel; choose min(window height * 0.65, window width minus side)
      const sideWidth = Math.min(320, window.innerWidth*0.35);
      const maxW = Math.min(window.innerWidth - sideWidth - 80, window.innerHeight - 200);
      return Math.max(200, maxW);
    }

    function createTilesFromImage(imgSrc, grid){
      const count = grid*grid;
      tiles = Array.from({length:count},(_,i)=>i);
      emptyIndex = tiles.length-1; // last tile is empty
    }

    function startLevel(){
      gridSize = LEVEL_MAP(level);
      createTilesFromImage(getImageForLevel(level), gridSize);
      shuffleTiles();
      renderBoard();
      levelNum.textContent = level;
      setMusicForLevel(level);
    }

    function getImageForLevel(lvl){
      const idx = Math.min(lvl-1, ASSETS.PUZZLE_IMAGES.length-1);
      return ASSETS.PUZZLE_IMAGES[idx] || ASSETS.PUZZLE_IMAGES[0];
    }

    function shuffleTiles(){
      // Fisher-Yates shuffle until not-solved
      do{
        for(let i=tiles.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          [tiles[i],tiles[j]]=[tiles[j],tiles[i]];
        }
      }while(isSolved());
      emptyIndex = tiles.indexOf(tiles.length-1);
    }

    function isSolved(){
      for(let i=0;i<tiles.length;i++) if(tiles[i]!==i) return false; return true;
    }

    function renderBoard(){
      const size = calculateBoardSize();
      board.style.width = size + 'px';
      board.style.height = size + 'px';
      board.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
      board.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
      board.innerHTML='';

      const img = getImageForLevel(level);
      const tileSize = 100 / gridSize;

      tiles.forEach((tileIndex, idx)=>{
        const el = document.createElement('div');
        el.className = 'tile';
        if(tileIndex === tiles.length-1){ el.classList.add('empty'); }
        else {
          // show portion of image via background-position
          const row = Math.floor(tileIndex / gridSize);
          const col = tileIndex % gridSize;
          el.style.backgroundImage = `url(${img})`;
          el.style.backgroundSize = `${gridSize*100}% ${gridSize*100}%`;
          el.style.backgroundPosition = `${col * tileSize}% ${row * tileSize}%`;
        }
        el.dataset.index = idx;
        el.addEventListener('click', onTileClick);
        board.appendChild(el);
      });

      // apply wooden frame look (subtle)
      board.style.border = '8px solid rgba(0,0,0,0.5)';
      board.style.borderRadius = '6px';
    }

    function onTileClick(e){
      const idx = parseInt(e.currentTarget.dataset.index);
      if(tiles[idx] === tiles.length-1) return; // clicked empty

      if(selectedTile===null){ selectedTile = idx; e.currentTarget.style.outline='3px solid rgba(255,255,255,0.2)'; }
      else{
        // swap
        [tiles[selectedTile], tiles[idx]] = [tiles[idx], tiles[selectedTile]];
        selectedTile = null;
        renderBoard();
        if(isSolved()){
          setTimeout(()=>{ alert('¡Nivel completado!'); if(level<20) { level++; startLevel(); } },200);
        }
      }
    }

    function loadLevel(){ startLevel(); }

    // Resize handling
    window.addEventListener('resize', ()=>{ renderBoard(); });

    // initialize
    (function init(){
      // set UI images
      document.getElementById('splash-img').src = ASSETS.SPLASH_IMAGE;
      document.getElementById('footerImg').src = ASSETS.FOOTER_LOGO;
      document.getElementById('link1img').src = ASSETS.LINK1;
      document.getElementById('link2img').src = ASSETS.LINK2;
      // initial board config
      levelNum.textContent = level;
      setMusicForLevel(level);
    })();

  </script>
</body>
</html>

