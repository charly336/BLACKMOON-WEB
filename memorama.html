<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Danza A茅rea Runner</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #000;
    color: white;
    font-family: Arial, sans-serif;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: linear-gradient(#001, #333);
  }
  #controls {
    text-align: center;
    margin-top: 10px;
  }
  button {
    margin: 5px;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    background: #444;
    color: white;
    cursor: pointer;
  }
  button:hover { background: #666; }
</style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="400"></canvas>
<div id="controls">
  <button id="pauseBtn">革 Pausar</button>
  <button id="volDown"> -</button>
  <button id="volUp"> +</button>
  <button id="restartBtn"> Reiniciar</button>
</div>

<script>
// -------------------- CONFIGURACIN PERSONALIZABLE -------------------- //
const musicTracks = [
  "6.-Silencio de la Noche.m4a",
  "15.-En el aire soy todo.m4a",
  "1.- Volando con Black Moon.m4a",
  "8.-Soy un Quetzal en el Viento.m4a"
];

const images = {
  dancer: "bailarina 2.png",  // Spritesheet horizontal de 4 cuadros 
  obstacle: "tela 2.png",
  cloud: "nube.png",
  mountain: "mountain 2.png",
  sun: "sol 2.png",
  moon: "luna.png"
};
// ---------------------------------------------------------------------- //

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let gameOver = false;
let score = 0;
let record = localStorage.getItem("recordDanza") || 0;
let isDay = false;

let dancer = {
  x: 100,
  y: 300,
  width: 60,
  height: 80,
  vy: 0,
  jump: false,
  frame: 0,
  frameCount: 4,
  frameDelay: 8,
  frameTimer: 0
};

let gravity = 0.7;
let obstacles = [];

let musicIndex = 0;
let currentMusic = new Audio(musicTracks[musicIndex]);
currentMusic.loop = true;
currentMusic.volume = 0.5;
currentMusic.play();

// Carga de im谩genes
const dancerImg = new Image(); dancerImg.src = images.dancer;
const obstacleImg = new Image(); obstacleImg.src = images.obstacle;
const cloudImg = new Image(); cloudImg.src = images.cloud;
const mountainImg = new Image(); mountainImg.src = images.mountain;
const sunImg = new Image(); sunImg.src = images.sun;
const moonImg = new Image(); moonImg.src = images.moon;

// -------------------- FUNCIONES PRINCIPALES -------------------- //
document.addEventListener("keydown", e => {
  if (e.code === "Space" && !dancer.jump && !gameOver) {
    dancer.vy = -13;
    dancer.jump = true;
  }
});

function drawBackground() {
  ctx.fillStyle = isDay ? "#87CEEB" : "#001";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  if (isDay) ctx.drawImage(sunImg, 650, 40, 80, 80);
  else ctx.drawImage(moonImg, 650, 40, 80, 80);

  ctx.drawImage(mountainImg, 0, 220, 800, 200);
  ctx.drawImage(cloudImg, (Date.now() / 20) % 800 - 800, 50, 200, 100);
  ctx.drawImage(cloudImg, (Date.now() / 20) % 800, 100, 200, 100);
}

function drawDancer() {
  // Animaci贸n por sprites
  const spriteWidth = dancerImg.width / dancer.frameCount;
  const spriteHeight = dancerImg.height;

  if (!dancer.jump) {
    dancer.frameTimer++;
    if (dancer.frameTimer >= dancer.frameDelay) {
      dancer.frame = (dancer.frame + 1) % dancer.frameCount;
      dancer.frameTimer = 0;
    }
  }

  ctx.drawImage(
    dancerImg,
    spriteWidth * dancer.frame, 0, spriteWidth, spriteHeight,
    dancer.x, dancer.y, dancer.width, dancer.height
  );
}

function drawObstacles() {
  for (let o of obstacles) {
    ctx.drawImage(obstacleImg, o.x, o.y, o.width, o.height);
  }
}

function update() {
  if (gameOver) return;

  dancer.y += dancer.vy;
  dancer.vy += gravity;

  if (dancer.y >= 300) {
    dancer.y = 300;
    dancer.jump = false;
  }

  // Obst谩culos
  if (Math.random() < 0.02) {
    obstacles.push({ x: 800, y: 320, width: 40, height: 60 });
  }

  for (let o of obstacles) {
    o.x -= 6;
    if (o.x + o.width < 0) obstacles.shift();

    // Colisi贸n
    if (
      dancer.x < o.x + o.width &&
      dancer.x + dancer.width > o.x &&
      dancer.y + dancer.height > o.y
    ) {
      gameOver = true;
      if (score > record) {
        record = score;
        localStorage.setItem("recordDanza", record);
      }
    }
  }

  score += 10;

  // Cambio de m煤sica
  if (score % 5000 === 0) {
    musicIndex = (musicIndex + 1) % musicTracks.length;
    currentMusic.pause();
    currentMusic = new Audio(musicTracks[musicIndex]);
    currentMusic.loop = true;
    currentMusic.volume = 0.5;
    currentMusic.play();
  }

  // Cambio d铆a/noche
  if (score % 6000 === 0) {
    isDay = !isDay;
  }
}

function drawUI() {
  ctx.font = "20px Arial";
  ctx.fillStyle = "white";
  ctx.fillText("Puntuaci贸n: " + score, 20, 30);
  ctx.fillText("R茅cord: " + record, 20, 60);
  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "40px Arial";
    ctx.fillText("Fin del juego", 280, 200);
  }
}

function loop() {
  drawBackground();
  update();
  drawObstacles();
  drawDancer();
  drawUI();
  requestAnimationFrame(loop);
}
loop();

// -------------------- CONTROLES -------------------- //
document.getElementById("pauseBtn").onclick = () => {
  if (currentMusic.paused) {
    currentMusic.play();
    gameOver = false;
  } else {
    currentMusic.pause();
    gameOver = true;
  }
};

document.getElementById("volDown").onclick = () => {
  currentMusic.volume = Math.max(0, currentMusic.volume - 0.1);
};
document.getElementById("volUp").onclick = () => {
  currentMusic.volume = Math.min(1, currentMusic.volume + 0.1);
};

document.getElementById("restartBtn").onclick = () => {
  score = 0;
  obstacles = [];
  gameOver = false;
  dancer.y = 300;
  dancer.vy = 0;
  currentMusic.pause();
  currentMusic.currentTime = 0;
  currentMusic.play();
};
</script>
</body>
</html>
