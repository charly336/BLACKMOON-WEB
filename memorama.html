<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlackMoon Runner - Noche en el Desierto</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #000;
  }
  canvas {
    display: block;
  }
  #info {
    position: absolute;
    top: 10px;
    left: 10px;
    color: #fff;
    font-family: Arial, sans-serif;
    font-size: 18px;
    z-index: 10;
    text-shadow: 0 0 8px #0ff;
  }
</style>
</head>
<body>
<div id="info">
  Puntuación: <span id="score">0</span> | Récord: <span id="record">0</span>
</div>
<canvas id="gameCanvas"></canvas>
<script>
// ===============================
// CONFIGURACIÓN EDITABLE
// ===============================
const CONFIG = {
  playerImage: 'https://i.imgur.com/COYcE7l.png', // Imagen de la bailarina
  obstacleImage: 'https://i.imgur.com/dvP4Q6M.png', // Obstáculo (aro/tela)
  gravity: 0.6,
  jumpForce: -10,
  speed: 5,
  obstacleGap: 250,
  musicSrc: '15.-En el aire soy todo.m4a',
  developerMode: false
};
// ===============================
// FIN CONFIGURACIÓN
// ===============================

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Variables
let player = { x: 100, y: canvas.height / 2, width: 80, height: 80, vy: 0, image: new Image() };
player.image.src = CONFIG.playerImage;

let obstacles = [];
let stars = [];
let clouds = [];
let mountains = [];
let score = 0;
let record = localStorage.getItem('blackmoon_record') || 0;
let gameOver = false;

// Recursos
let obstacleImg = new Image();
obstacleImg.src = CONFIG.obstacleImage;

// Música
const music = new Audio(CONFIG.musicSrc);
music.loop = true;
music.volume = 0.5;
music.play().catch(()=>{});

// Crear estrellas
for (let i = 0; i < 100; i++) {
  stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height / 2, size: Math.random() * 2, speed: Math.random() * 0.3 + 0.1 });
}

// Crear nubes
for (let i = 0; i < 6; i++) {
  clouds.push({ x: Math.random() * canvas.width, y: 50 + Math.random() * 150, width: 150 + Math.random() * 100, height: 60, speed: 0.3 + Math.random() * 0.2 });
}

// Crear montañas
for (let i = 0; i < 5; i++) {
  mountains.push({
    x: i * (canvas.width / 4),
    y: canvas.height - 200 + Math.random() * 50,
    width: 400,
    height: 200 + Math.random() * 50,
    color: `hsl(${Math.random() * 20 + 25}, 40%, 25%)`,
    speed: 0.5
  });
}

// Luna
const moon = { x: canvas.width - 200, y: 150, radius: 80 };

// Dibujar fondo desértico
function drawDesertBackground() {
  // Cielo degradado
  const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
  grad.addColorStop(0, '#010010');
  grad.addColorStop(1, '#160808');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Estrellas
  ctx.fillStyle = '#fff';
  for (let s of stars) {
    ctx.globalAlpha = 0.5 + Math.random() * 0.5;
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
    ctx.fill();
    s.x -= s.speed;
    if (s.x < 0) s.x = canvas.width + Math.random() * 50;
  }
  ctx.globalAlpha = 1;

  // Luna
  ctx.beginPath();
  ctx.arc(moon.x, moon.y, moon.radius, 0, Math.PI * 2);
  ctx.fillStyle = '#fdfde7';
  ctx.shadowColor = '#fff';
  ctx.shadowBlur = 25;
  ctx.fill();
  ctx.shadowBlur = 0;

  // Montañas
  for (let m of mountains) {
    ctx.fillStyle = m.color;
    ctx.beginPath();
    ctx.moveTo(m.x, canvas.height);
    ctx.lineTo(m.x + m.width / 2, m.y);
    ctx.lineTo(m.x + m.width, canvas.height);
    ctx.closePath();
    ctx.fill();
    m.x -= m.speed;
    if (m.x + m.width < 0) m.x = canvas.width + Math.random() * 200;
  }

  // Nubes
  ctx.fillStyle = 'rgba(255,255,255,0.3)';
  for (let c of clouds) {
    ctx.beginPath();
    ctx.ellipse(c.x, c.y, c.width / 2, c.height / 2, 0, 0, Math.PI * 2);
    ctx.fill();
    c.x -= c.speed;
    if (c.x + c.width < 0) c.x = canvas.width + Math.random() * 300;
  }

  // Arena del desierto
  ctx.fillStyle = '#4a3524';
  ctx.fillRect(0, canvas.height - 80, canvas.width, 80);
}

function createObstacle() {
  const height = 80 + Math.random() * 150;
  const y = canvas.height - height - 80;
  obstacles.push({ x: canvas.width, y, width: 60, height });
}

function drawPlayer() {
  ctx.drawImage(player.image, player.x, player.y, player.width, player.height);
}

function drawObstacles() {
  obstacles.forEach(o => {
    ctx.drawImage(obstacleImg, o.x, o.y, o.width, o.height);
  });
}

function update() {
  if (gameOver) return;

  drawDesertBackground();

  player.vy += CONFIG.gravity;
  player.y += player.vy;
  if (player.y + player.height > canvas.height - 80) {
    player.y = canvas.height - 80 - player.height;
    player.vy = 0;
  }
  if (player.y < 0) {
    player.y = 0;
    player.vy = 0;
  }

  obstacles.forEach(o => o.x -= CONFIG.speed);
  obstacles = obstacles.filter(o => o.x + o.width > 0);

  if (Math.random() < 0.02) createObstacle();

  obstacles.forEach(o => {
    if (
      player.x < o.x + o.width &&
      player.x + player.width > o.x &&
      player.y + player.height > o.y
    ) {
      gameOver = true;
      music.pause();
      saveRecord();
      showGameOver();
    }
  });

  drawPlayer();
  drawObstacles();
  score++;
  document.getElementById('score').innerText = score;
  document.getElementById('record').innerText = record;
  requestAnimationFrame(update);
}

function jump() {
  if (!gameOver) {
    player.vy = CONFIG.jumpForce;
  } else {
    restart();
  }
}

function showGameOver() {
  ctx.fillStyle = 'rgba(0,0,0,0.6)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#fff';
  ctx.font = 'bold 48px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 30);
  ctx.font = '24px Arial';
  ctx.fillText('Haz click o toca para reiniciar', canvas.width/2, canvas.height/2 + 20);
}

function saveRecord() {
  if (score > record) {
    record = score;
    localStorage.setItem('blackmoon_record', record);
  }
}

function restart() {
  obstacles = [];
  score = 0;
  gameOver = false;
  player.y = canvas.height / 2;
  player.vy = 0;
  music.currentTime = 0;
  music.play();
  update();
}

window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

window.addEventListener('keydown', e => {
  if (e.code === 'Space') jump();
});
canvas.addEventListener('click', jump);

// Iniciar
document.getElementById('record').innerText = record;
if (CONFIG.developerMode) console.log('CONFIG:', CONFIG);
update();
</script>
</body>
</html>
