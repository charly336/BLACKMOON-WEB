<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Escalada Infinita - BlackMoon Games</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(#aee1ff, #ffffff);
  }

  canvas {
    display: block;
    background: url('fondo_dia.jpg');
    background-size: cover;
    margin: auto;
    border: 3px solid #222;
  }

  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-family: Arial, sans-serif;
    font-size: 20px;
  }

  button {
    background: #222;
    color: #fff;
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    margin: 4px;
    cursor: pointer;
  }

  button:hover {
    background: #444;
  }
</style>
</head>
<body>
<div id="ui">
  <div>Puntaje: <span id="score">0</span></div>
  <div>Récord: <span id="record">0</span></div>
  <button id="pauseBtn">Pausar Juego</button>
  <button id="musicBtn">Pausar Música</button>
</div>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<audio id="musicaFondo" src="musica.mp3" loop autoplay></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const musica = document.getElementById("musicaFondo");
let juegoPausado = false;
let musicaPausada = false;

document.getElementById("pauseBtn").onclick = () => {
  juegoPausado = !juegoPausado;
  document.getElementById("pauseBtn").innerText = juegoPausado ? "Reanudar Juego" : "Pausar Juego";
};

document.getElementById("musicBtn").onclick = () => {
  if (musicaPausada) {
    musica.play();
  } else {
    musica.pause();
  }
  musicaPausada = !musicaPausada;
  document.getElementById("musicBtn").innerText = musicaPausada ? "Reanudar Música" : "Pausar Música";
};

let jugadora = {
  x: 180,
  y: 500,
  ancho: 40,
  alto: 60,
  velocidadY: 0,
  gravedad: 0.3, // Caída más lenta
  salto: -7,
  imagen: new Image()
};
jugadora.imagen.src = "bailarina.png";

let plataformas = [];
let trampas = [];
let puntuacion = 0;
let record = localStorage.getItem("recordEscalada") || 0;

function crearPlataforma(x, y, ancho, alto, color = "gray") {
  plataformas.push({x, y, ancho, alto, color});
}

function crearTrampa(x, y, ancho, alto) {
  trampas.push({x, y, ancho, alto, color: "red"});
}

for (let i = 0; i < 8; i++) {
  crearPlataforma(Math.random() * 300, i * 80, 100, 15);
}

function saltar() {
  if (!juegoPausado) jugadora.velocidadY = jugadora.salto;
}
window.addEventListener("keydown", (e) => {
  if (e.code === "Space") saltar();
});

function actualizar() {
  if (juegoPausado) return;

  jugadora.y += jugadora.velocidadY;
  jugadora.velocidadY += jugadora.gravedad;

  if (jugadora.y > canvas.height - jugadora.alto) {
    jugadora.y = canvas.height - jugadora.alto;
    jugadora.velocidadY = 0;
  }

  plataformas.forEach(p => {
    p.y -= 2;
    if (
      jugadora.x < p.x + p.ancho &&
      jugadora.x + jugadora.ancho > p.x &&
      jugadora.y + jugadora.alto > p.y &&
      jugadora.y + jugadora.alto < p.y + 15
    ) {
      jugadora.velocidadY = jugadora.salto;
      puntuacion++;
      document.getElementById("score").innerText = puntuacion;
      if (puntuacion > record) {
        record = puntuacion;
        localStorage.setItem("recordEscalada", record);
        document.getElementById("record").innerText = record;
      }
    }
  });

  trampas.forEach(t => {
    t.y -= 2;
    if (
      jugadora.x < t.x + t.ancho &&
      jugadora.x + jugadora.ancho > t.x &&
      jugadora.y + jugadora.alto > t.y &&
      jugadora.y < t.y + t.alto
    ) {
      finJuego();
    }
  });

  plataformas = plataformas.filter(p => p.y > -20);
  trampas = trampas.filter(t => t.y > -20);

  while (plataformas.length < 8) {
    if (Math.random() < 0.2) {
      crearTrampa(Math.random() * 300, canvas.height + 10, 80, 15);
    } else {
      crearPlataforma(Math.random() * 300, canvas.height + 10, 100, 15);
    }
  }
}

function finJuego() {
  alert("¡Caiste en una trampa! Fin del juego.\nPuntaje: " + puntuacion);
  location.reload();
}

function dibujar() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(jugadora.imagen, jugadora.x, jugadora.y, jugadora.ancho, jugadora.alto);
  plataformas.forEach(p => {
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x, p.y, p.ancho, p.alto);
  });
  trampas.forEach(t => {
    ctx.fillStyle = "red";
    ctx.fillRect(t.x, t.y, t.ancho, t.alto);
  });
}

function loop() {
  actualizar();
  dibujar();
  requestAnimationFrame(loop);
}

document.getElementById("record").innerText = record;
loop();
</script>
</body>
</html>

